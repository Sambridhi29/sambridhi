<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ping Pong — Classic FX Edition</title>
  <style>
    :root{
      --bg-1: #050615;
      --bg-2: #071a2a;
      --accent: #22d3ee;
      --highlight: #facc15;
      --muted: #9aa6b2;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#e6eef6}
    body{display:flex;align-items:center;justify-content:center;padding:14px}
    .container{width:980px;max-width:96%;position:relative}
    .panel{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .title{font-weight:800;font-size:18px}
    .controls{display:flex;gap:8px;align-items:center}
    button, select{background:var(--accent);border:none;color:#05202a;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .muted{color:var(--muted);font-size:13px}
    .game-wrap{
      position:relative;border-radius:12px;overflow:hidden;height:560px;
      background:linear-gradient(180deg,#03131b 0%, #042638 100%);
      box-shadow: inset 0 0 40px rgba(34,211,238,0.03), inset 0 0 120px rgba(124,58,237,0.02);
      border: 2px solid rgba(255,255,255,0.03);
    }
    .game-wrap::before{
      content:"";position:absolute;inset:0;border-radius:12px;
      box-shadow:0 0 30px rgba(34,211,238,0.08),0 0 60px rgba(124,58,237,0.06),inset 0 0 30px rgba(34,211,238,0.04);
      pointer-events:none;mix-blend-mode:screen;
    }
    canvas{display:block;width:100%;height:100%}
    .hud{position:absolute;left:12px;top:12px;display:flex;gap:8px;align-items:center;z-index:4}
    .chip{background:rgba(2,6,23,0.6);padding:8px 12px;border-radius:999px;font-weight:700;color:var(--muted);display:flex;gap:8px;align-items:center}
    .chip .num{color:#fff}
    #mobileControls{position:fixed;inset:0;pointer-events:none;z-index:6}
    #mobileControls .control{position:absolute;bottom:8%;display:flex;flex-direction:column;gap:12px;pointer-events:auto}
    .right-controls{right:6%}
    #mobileControls button{width:64px;height:64px;border-radius:50%;border:none;background:linear-gradient(180deg, rgba(34,211,238,0.22), rgba(124,58,237,0.12));color:#fff;font-size:28px;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.4)}
    #mobileControls button:active{transform:scale(0.96);opacity:0.9}
    @media (max-width:600px){
      .game-wrap{height:68vh}
      #mobileControls .control{bottom:6%}
      #mobileControls button{width:72px;height:72px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <header>
        <div class="title">Ping Pong — Classic FX Edition</div>
        <div class="controls">
          <select id="aiSelect">
            <option value="easy">AI: Easy</option>
            <option value="medium" selected>AI: Medium</option>
            <option value="hard">AI: Hard</option>
          </select>
          <button id="startBtn">Start</button>
          <button id="pauseBtn" class="ghost">Pause</button>
          <button id="resetBtn" class="ghost">Reset</button>
        </div>
      </header>

      <div class="game-wrap" id="gameWrap">
        <canvas id="gameCanvas" width="880" height="520"></canvas>
        <div class="hud"><div class="chip"><div class="num" id="leftScore">0</div></div><div class="chip"><div class="num" id="rightScore">0</div></div></div>
      </div>

      <div class="muted" style="margin-top:10px;display:flex;justify-content:space-between;align-items:center">
        <div>Controls: Arrow keys or on-screen buttons</div>
        <div style="display:flex;gap:12px;align-items:center">
          <label>Sound <input id="soundToggle" type="checkbox" checked></label>
          <label>Music <input id="musicToggle" type="checkbox" checked></label>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Controls -->
  <div id="mobileControls">
    <div class="control right-controls">
      <button id="rightUp">▲</button>
      <button id="rightDown">▼</button>
    </div>
  </div>

  <!-- Background classical music (Mozart) -->
  <audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_05978bfa6e.mp3?filename=mozart-piano-sonata-14258.mp3" loop></audio>

<script>
(() => {
  const BASE_W=880, BASE_H=520;
  const canvas=document.getElementById('gameCanvas'),ctx=canvas.getContext('2d');
  const gameWrap=document.getElementById('gameWrap');
  const leftScoreEl=document.getElementById('leftScore'), rightScoreEl=document.getElementById('rightScore');
  const bgMusic=document.getElementById('bgMusic');
  const soundToggle=document.getElementById('soundToggle'), musicToggle=document.getElementById('musicToggle');

  let W=BASE_W,H=BASE_H,scale=1;
  let paddleW=14,paddleH=160,paddleS=6.5,ballR=12;
  let left={x:20,y:200,vy:0},right={x:820,y:200,vy:0};
  let ball={x:440,y:260,vx:6.5,vy:3.5,r:ballR};
  let leftScore=0,rightScore=0,running=false,paused=false;
  let aiFactor=0.12;const aiFactors={easy:0.06,medium:0.12,hard:0.22};

  // ink splashes
  let splashes = [];

  // audio context reuse
  let audioCtx = null;
  function ensureAudio(){
    if(!audioCtx && soundToggle.checked){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
  }

  function playHitSound(){
    if(!soundToggle.checked) return;
    ensureAudio();
    if(!audioCtx) return;
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'square';
    o.frequency.setValueAtTime(700 + Math.random()*300, now);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.06, now + 0.01);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(now);
    o.stop(now + 0.09);
  }

  function playSFX(type){
    if(!soundToggle.checked) return;
    ensureAudio();
    if(!audioCtx) return;
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    if(type==='wall'){ o.frequency.setValueAtTime(700, now); o.type='sine'; g.gain.setValueAtTime(0.05, now); }
    else if(type==='score'){ o.frequency.setValueAtTime(320, now); o.type='sine'; g.gain.setValueAtTime(0.09, now); }
    o.connect(g); g.connect(audioCtx.destination);
    o.start(now); o.stop(now + 0.12);
  }

  function spawnSplash(x,y){
    const count = 20 + Math.floor(Math.random()*10);
    for(let i=0;i<count;i++){
      const angle = Math.random()*Math.PI*2;
      const speed = (Math.random()*4 + 1) * (1 + 0.2*Math.random());
      splashes.push({
        x: x + (Math.random()-0.5)*6,
        y: y + (Math.random()-0.5)*6,
        vx: Math.cos(angle)*speed,
        vy: Math.sin(angle)*speed,
        life: 1,
        decay: 0.02 + Math.random()*0.02,
        color: `hsl(${Math.floor(Math.random()*360)},80%,55%)`,
        size: 6 + Math.random()*6
      });
    }
    // limit splashes
    if(splashes.length > 800) splashes.splice(0, splashes.length - 800);
  }

  function updateSplashes(){
    for(let i=splashes.length-1;i>=0;i--){
      const p = splashes[i];
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.08; // gravity
      p.vx *= 0.995;
      p.vy *= 0.995;
      p.life -= p.decay;
      if(p.life <= 0) splashes.splice(i,1);
    }
  }

  function drawSplashes(){
    ctx.save();
    for(const p of splashes){
      ctx.globalAlpha = Math.max(0, p.life);
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, Math.max(1, p.size * p.life), 0, Math.PI*2);
      ctx.fill();
    }
    ctx.globalAlpha = 1;
    ctx.restore();
  }

  function resizeCanvas(){
    const rect=gameWrap.getBoundingClientRect();const DPR=window.devicePixelRatio||1;
    canvas.style.width=rect.width+'px';canvas.style.height=rect.height+'px';
    canvas.width=Math.round(rect.width*DPR);canvas.height=Math.round(rect.height*DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);W=rect.width;H=rect.height;scale=Math.min(W/BASE_W,H/BASE_H);
    paddleW = Math.round(14*scale);
    paddleH = Math.round(160*scale);
    ballR = Math.max(10, Math.round(12*scale));
    left.x = 20*scale;
    right.x = W - 20*scale - paddleW;
    // clamp y positions
    left.y = Math.max(0, Math.min(H - paddleH, left.y));
    right.y = Math.max(0, Math.min(H - paddleH, right.y));
  }
  window.addEventListener('resize',resizeCanvas);resizeCanvas();

  function serve(dir=1){
    ball.x = W/2; ball.y = H/2;
    const speed = (6.5 + Math.random()*1.5) * scale;
    const angle = (Math.random()*0.6 - 0.3);
    ball.vx = (dir?1:-1) * speed;
    ball.vy = angle * speed * 2;
  }
  serve(1);

  function updateAI(){
    const target = ball.y - paddleH/2;
    const diff = target - left.y;
    left.vy = Math.max(-paddleS*scale, Math.min(paddleS*scale, diff * aiFactor));
    left.y += left.vy;
    left.y = Math.max(0, Math.min(H - paddleH, left.y));
  }

  function step(){
    if(!running) return;
    if(paused){
      // still update splashes so they fade even when paused
      updateSplashes();
      return;
    }

    // move right paddle (player)
    right.y += right.vy;
    right.y = Math.max(0, Math.min(H - paddleH, right.y));

    // AI
    updateAI();

    // move ball
    ball.x += ball.vx;
    ball.y += ball.vy;

    // walls
    if(ball.y - ball.r < 0){
      ball.y = ball.r; ball.vy *= -1; playSFX('wall');
    }
    if(ball.y + ball.r > H){
      ball.y = H - ball.r; ball.vy *= -1; playSFX('wall');
    }

    // left paddle collision
    if(ball.x - ball.r < left.x + paddleW && ball.x - ball.r > left.x - 6){
      if(ball.y > left.y && ball.y < left.y + paddleH){
        ball.x = left.x + paddleW + ball.r;
        const rel = (ball.y - (left.y + paddleH/2)) / (paddleH/2);
        const speed = Math.hypot(ball.vx, ball.vy) * 1.07;
        ball.vx = Math.abs(speed);
        ball.vy = rel * speed;
        playHitSound();
        spawnSplash(ball.x - 6, ball.y);
      }
    }

    // right paddle collision
    if(ball.x + ball.r > right.x && ball.x + ball.r < right.x + paddleW + 6){
      if(ball.y > right.y && ball.y < right.y + paddleH){
        ball.x = right.x - ball.r;
        const rel = (ball.y - (right.y + paddleH/2)) / (paddleH/2);
        const speed = Math.hypot(ball.vx, ball.vy) * 1.07;
        ball.vx = -Math.abs(speed);
        ball.vy = rel * speed;
        playHitSound();
        spawnSplash(ball.x + 6, ball.y);
      }
    }

    // scoring
    if(ball.x < -60){
      rightScore++; updateScores(); playSFX('score'); serve(true);
    } else if(ball.x > W + 60){
      leftScore++; updateScores(); playSFX('score'); serve(false);
    }

    // update splashes
    updateSplashes();
  }

  function draw(){
    // clear
    ctx.clearRect(0,0,W,H);

    // mid dashed
    ctx.fillStyle = 'rgba(255,255,255,0.06)';
    for(let i=12;i<H;i+=30) ctx.fillRect(W/2 - 2, i, 4, 18);

    // draw splashes behind paddles/ball
    drawSplashes();

    // left paddle (neon)
    ctx.save();
    ctx.fillStyle = 'rgba(34,211,238,0.95)';
    ctx.shadowColor = 'rgba(34,211,238,0.45)';
    ctx.shadowBlur = 18;
    roundRect(left.x, left.y, paddleW, paddleH, 8);
    ctx.fill();
    ctx.restore();

    // right paddle
    ctx.save();
    ctx.fillStyle = 'rgba(250,204,21,0.95)';
    ctx.shadowColor = 'rgba(250,204,21,0.35)';
    ctx.shadowBlur = 14;
    roundRect(right.x, right.y, paddleW, paddleH, 8);
    ctx.fill();
    ctx.restore();

    // ball with glow
    ctx.save();
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fillStyle = '#fff';
    ctx.shadowColor = 'rgba(255,255,255,0.9)';
    ctx.shadowBlur = 28;
    ctx.fill();
    ctx.restore();
  }

  function roundRect(x,y,w,h,r){
    ctx.beginPath(); ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath();
  }

  function loop(){
    step();
    draw();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  // Inputs
  const keys = {};
  window.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ paused = !paused; } keys[e.code]=true; updateInput(); });
  window.addEventListener('keyup', (e)=>{ keys[e.code]=false; updateInput(); });
  function updateInput(){
    if(keys['ArrowUp']) right.vy = -paddleS * scale;
    else if(keys['ArrowDown']) right.vy = paddleS * scale;
    else right.vy = 0;
  }

  // Mobile controls
  function addMobile(btn, setFn, releaseFn){
    if(!btn) return;
    btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); setFn(); }, {passive:false});
    btn.addEventListener('touchend', (e)=>{ e.preventDefault(); releaseFn(); }, {passive:false});
    btn.addEventListener('mousedown', (e)=>{ e.preventDefault(); setFn(); });
    btn.addEventListener('mouseup', (e)=>{ e.preventDefault(); releaseFn(); });
    btn.addEventListener('mouseleave', (e)=>{ e.preventDefault(); releaseFn(); });
  }
  addMobile(document.getElementById('rightUp'), ()=>{ right.vy = -paddleS * scale; }, ()=>{ right.vy = 0; });
  addMobile(document.getElementById('rightDown'), ()=>{ right.vy = paddleS * scale; }, ()=>{ right.vy = 0; });

  // Start/pause/reset handlers & audio
  document.getElementById('startBtn').addEventListener('click', ()=>{
    running = true; paused = false; document.getElementById('startBtn').textContent = 'Restart';
    // ensure audio context and start music
    ensureAudio();
    if(musicToggle.checked){
      bgMusic.volume = 0.45;
      bgMusic.play().catch(()=>{ /* autoplay blocked until user gesture; startBtn is a gesture so should work */ });
    }
  });
  document.getElementById('pauseBtn').addEventListener('click', ()=>{ paused = !paused; });
  document.getElementById('resetBtn').addEventListener('click', ()=>{ running=false; paused=false; leftScore=0; rightScore=0; updateScores(); serve(1); });

  document.getElementById('aiSelect').addEventListener('change', (e)=>{ aiFactor = aiFactors[e.target.value] || aiFactors.medium; });

  function updateScores(){ leftScoreEl.textContent = leftScore; rightScoreEl.textContent = rightScore; }

  // ensure audio on first gesture
  document.addEventListener('pointerdown', ()=>{ ensureAudio(); }, {once:true});
  document.addEventListener('touchstart', ()=>{ ensureAudio(); }, {once:true});
})();
</script>
</body>
</html>
